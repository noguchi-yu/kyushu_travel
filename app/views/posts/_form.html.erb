<div class="min-h-screen">
  <div class="flex justify-center my-14">
    <div class="card w-[800px]  bg-neutral-content text-neutral-600">
      <div class="card-body p-10">
        <%= form_with(model: post, local: true, data: { turbo: false }) do |f| %>
          <div class="mb-8 flex justify-center">
            <% if f.object.new_record? %>
              <div class="text-xl font-bold">新規投稿</div>
            <% else %>
              <div class="text-xl font-bold">投稿編集</div>
            <% end %>
          </div>
          <%= render 'shared/error_messages', object: f.object %>
          <div class="flex flex-col mt-5">
            <%= f.label :title, "タイトル" %>
            <%= f.text_field :title, id: "Title", placeholder: "スポット名や市町村名", class: "input input-bordered w-full", autocomplete: "off" %>
            <span class="text-xs text-right mt-1">必須</span>
          </div>
          <div class="flex flex-col mt-5">
            <%= f.label :address, "住所" %>
            <%= f.text_field :address, id: "Address", placeholder: "県名から住所入力", class: "input input-bordered w-full", autocomplete: "off" %>
            <span class="text-xs text-right mt-1">必須（同じ住所は投稿できません）</span>
          </div>
          <div class="flex flex-col mt-5">
            <%= f.label :body, "コメント" %>
            <%= f.text_area :body, id: "Body", placeholder: "スポットの説明、おすすめポイント", class: "input input-bordered w-full textarea", autocomplete: "off" %>
            <span id="charCount" class="text-xs text-right mt-1">300文字まで</span>
          </div>
          <div class="flex flex-col mt-5">
            <div class="flex flex-col">
              <%= f.label :images, "写真" %>
              <%= f.file_field :images, multiple: true, class: "file-input file-input-bordered file-input w-full text-neutral-600 font-normal" %>
              <%= f.hidden_field :images_cache %>
              <span class="text-xs text-right mt-1">3枚まで（ファイル形式：jpeg、jpg、png、heic）</span>
            </div>
            <div id="preview-post-images" class="flex flex-wrap justify-center">
              <% if post.images.present? %>
                <% post.images.each do |image| %>
                  <%= image_tag image.to_s, class: "w-1/3 h-auto object-contain m-2" %>
                <% end %>
              <% end %>
            </div>
          </div>
          <div class="flex justify-center mt-7">
            <%= f.submit (f.object.new_record? ? "投稿する" : "更新する"), class: "btn btn-success px-10 py-4 text-neutral-600" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
<script>
document.addEventListener("turbo:load", function () {
  let inputTitle = document.getElementById('Title');
  let inputAddress = document.getElementById('Address');

  // 日本の施設に設定
  let options = {
    types: ['establishment'],
    componentRestrictions: { country: 'JP' },
  };

  // オートコンプリート適用
  let autocompleteTitle = new google.maps.places.Autocomplete(inputTitle, options);
  let autocompleteAddress = new google.maps.places.Autocomplete(inputAddress, options);

  // タイトルのオートコンプリートが選択されたとき
  autocompleteTitle.addListener('place_changed', function() {
    let place = autocompleteTitle.getPlace();
    inputTitle.value = place.name;
    inputAddress.value = place.formatted_address;
  });

  // 住所のオートコンプリートが選択されたとき
  autocompleteAddress.addListener('place_changed', function() {
    let place = autocompleteAddress.getPlace();
    inputTitle.value = place.name;
    inputAddress.value = place.formatted_address;
  });
});
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV["GOOGLE_MAPS_API_KEY"] %>&libraries=places&callback=initAutocomplete" async defer>
</script>
